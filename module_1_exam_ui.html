<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Module 1 Final Exam</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f6f7f8}
  .wrap{max-width:900px;margin:auto;padding:16px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
  .q{font-weight:700;margin:8px 0}
  .opts label{display:block;margin:6px 0;padding:8px;border:1px solid #e5e7eb;border-radius:8px}
  .short{width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:8px}
  .ok{background:#dcfce7} .bad{background:#fee2e2}
  button{padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;cursor:pointer}
  button.primary{background:#111;color:#fff;border-color:#111}
  .timer{position:fixed;top:12px;right:12px;background:#111;color:#fff;padding:6px 12px;border-radius:999px;font-weight:700;z-index:1000}
  .muted{opacity:.75}
  em{display:block;margin-top:6px;color:#4b5563}
</style>
</head><body>
<div id="root" class="wrap"></div>
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
<script type="text/babel" data-presets="react">
const {useState,useEffect}=React; const KEY='m1.final.v1';
const toL = s => (s??'').toString().trim().toLowerCase();
const uniq = a => Array.from(new Set(a));
const tokenize = s => toL(s).replace(/[^\w\s]/g,' ').split(/\s+/).filter(Boolean);
const hasAll = (bag, req) => req.every(w => bag.has(w));
const jaccard = (a,b)=>{const A=new Set(a),B=new Set(b);const inter=[...A].filter(x=>B.has(x)).length;return inter/Math.max(1,A.size+B.size-inter)};
function gradeShort(user, rubric){
  const words = tokenize(user).map(w=>rubric.synonyms && rubric.synonyms[w] ? rubric.synonyms[w] : w);
  const bag = new Set(words);
  const targets = Array.isArray(rubric.keywords[0])?rubric.keywords: [rubric.keywords];
  let hits=0;
  for(const group of targets){ if(hasAll(bag, group.map(toL))) hits++; }
  const cover = hits/Math.max(1,targets.length);
  const sim = jaccard(words, uniq(targets.flat()));
  return Math.max(cover, sim) >= (rubric.minScore||0.6);
}
const initialQs = [
  {type:'tf', prompt:'Standing requires a concrete injury.', choices:['True','False'], answer:'True', hint:'*Standing needs an actual, concrete stake in the outcome.*'},
  {type:'tf', prompt:'Mediation outcomes are generally binding.', choices:['True','False'], answer:'False', hint:'*Mediation helps parties agree, but the mediator does not impose a binding decision.*'},
  {type:'tf', prompt:'Appellate courts re-try cases and hear witnesses.', choices:['True','False'], answer:'False', hint:'*Appellate courts review legal errors; no new witnesses.*'},
  {type:'tf', prompt:'Federal courts have general jurisdiction over any case.', choices:['True','False'], answer:'False', hint:'*Federal jurisdiction is limited to federal questions or diversity with amount in controversy > $75,000.*'},
  {type:'tf', prompt:'Venue refers to the geographic location where a case should be heard.', choices:['True','False'], answer:'True', hint:'*Venue is the proper geographic location.*'}
];
function Timer({start,active,onEnd}){
  const [t,setT]=useState(start);
  useEffect(()=>{ if(!active) return; if(t<=0){onEnd&&onEnd();return;} const id=setInterval(()=>setT(s=>s-1),1000); return ()=>clearInterval(id); },[active,t]);
  const m=Math.floor(t/60), s=t%60; return <div className="timer">{m}:{String(s).padStart(2,'0')}</div>
}
function App(){
  const [started,setStarted]=useState(false);
  const [qs]=useState(initialQs);
  const [ans,setAns]=useState(()=>{try{return JSON.parse(localStorage.getItem(KEY)||'{}').ans||{}}catch{return {}}});
  const [graded,setGraded]=useState(false);
  const setA=(i,v)=>setAns(p=>{const n={...p};n[i]=v;return n});
  const scoreOne=(q,a)=>{if(q.type==='multi'){const A=(a||[]).map(toL).sort().join('|');const B=(q.answer||[]).map(toL).sort().join('|');return A===B;} if(q.type==='short'){return gradeShort(a, q.answer);} return toL(a)===toL(q.answer)};
  const total=qs.length; const correctCount=graded?qs.reduce((s,q,i)=>s+(scoreOne(q,ans[i])?1:0),0):0;
  return (
    <div>
      <Timer start={3000} active={started} onEnd={()=>alert('Time is up!')}/>
      <div className="card row">
        <div><strong>Module 1 Final Exam</strong></div>
        {!started && <button className="primary" onClick={()=>setStarted(true)}>Let's get this started</button>}
        {started && <div className="muted">Progress: {Object.values(ans).filter(v=>Array.isArray(v)?v.length:toL(v).length).length}/{total}</div>}
      </div>
      {started && qs.map((q,i)=>{
        const a=ans[i]??(q.type==='multi'?[]:'');
        const ok=graded?scoreOne(q,a):null;
        const cls=graded?(ok?'ok':'bad'):'';
        return (
          <div key={i} className={"card "+cls}>
            <div className="q">{i+1}. {q.prompt}</div>
            {q.type==='short' ? (
              <textarea className="short" rows="3" value={a} onChange={e=>setA(i,e.target.value)}/>
            ) : (
              <div className="opts">{q.choices.map((c,j)=>{
                const v=String(c);
                if(q.type==='multi'){
                  const checked=(a||[]).includes(v);
                  return <label key={j}><input type="checkbox" checked={checked} onChange={e=>{const set=new Set(a||[]); e.target.checked?set.add(v):set.delete(v); setA(i,[...set]);}}/> {v}</label>
                }
                return <label key={j}><input type="radio" name={`q${i}`} checked={a===v} onChange={()=>setA(i,v)}/> {v}</label>
              })}</div>
            )}
            {graded && !ok && <em>{q.hint}</em>}
          </div>
        );
      })}
      {started && <div className="card row"><div><strong>Ready to see your score?</strong></div><button className="primary" onClick={()=>setGraded(true)}>Score</button>{graded && <div><strong>Score:</strong> {correctCount}/{total}</div>}</div>}
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body></html>
